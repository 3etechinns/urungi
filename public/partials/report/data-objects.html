<div class="container-fluid object-tree" ng-init="getLayers()">

    <div class="row" ng-if="layers.length > 1" style="padding:5px;">
    <select id="selectLayer" class="form-control" ng-model="selectedLayerID" ng-options="obj._id as obj.name for obj in layers"
                                            ng-change="changeLayer(selectedLayerID)"></select>
    </div>
    <tg-dynamic-directive ng-model="rootItem" tg-dynamic-directive-view="getView">
    </tg-dynamic-directive>

    <script type="text/ng-template" id="nestable_item.html">
        <div >
            <div class="schema-element-report schema-item-report"  ng-if="(ngModelItem.elementRole == 'dimension' || ngModelItem.elementRole == 'measure') && ngModelItem.enabled != false" >


                <a class="list-group-item data-source-element schema-item-report" draggable="true" effect-allowed="copy" draggable-type="custom-object"
                   draggable-data="{
                        elementName: ngModelItem.elementName,
                        objectLabel: ngModelItem.elementLabel,
                        datasourceID:ngModelItem.datasourceID,
                        collectionID:ngModelItem.collectionID,
                        elementID: ngModelItem.elementID,
                        elementType: ngModelItem.elementType,
                        layerID: selectedLayer._id,
                        filterType: 'equal',
                        filterPrompt: false,
                        filterTypeLabel:'equal',
                        format:ngModelItem.format,
                        values:ngModelItem.values}">
                        {{ngModelItem.elementLabel}}
                    <i ng-if="(ngModelItem.elementType == 'number' || ngModelItem.elementType == 'date') && (!ngModelItem.count)" class="fa fa-toggle-down " ng-click="ngModelItem.isAggregateCollapsed = !ngModelItem.isAggregateCollapsed"></i>

                </a>


                <div class="schema-aggregate-element-container" ng-if="ngModelItem.elementType == 'number' || ngModelItem.elementType == 'date'" collapse="!ngModelItem.isAggregateCollapsed">
                    <a ng-if="(ngModelItem.elementType == 'number' || ngModelItem.elementType == 'date') && (!ngModelItem.count)"
                       class="list-group-item data-source-aggregation schema-item-report" ng-repeat="aggregation in fieldsAggregations[ngModelItem.elementType]"
                       draggable="true" effect-allowed="copy" draggable-type="custom-object" draggable-data="{
                       elementName: ngModelItem.elementName,
                       objectLabel: ngModelItem.elementLabel+' ('+aggregation.name+')',
                       datasourceID:ngModelItem.datasourceID,
                       collectionID:ngModelItem.collectionID,
                       elementID: ngModelItem.elementID,
                       layerID: selectedLayer._id,
                       elementType: ngModelItem.elementType,
                       filterType: 'equal',
                       filterPrompt: false,
                       filterTypeLabel:'equal',
                       format:ngModelItem.format,
                       aggregation: aggregation.value}" ng-bind="aggregation.name">

                       </a>
                </div>

            </div>

            <div class="schema-element-report schema-item-report"  ng-if="(ngModelItem.elementRole == 'dimension' || ngModelItem.elementRole == 'measure') && ngModelItem.enabled == false" >
                <span class="list-group-item data-source-element schema-item-report element-disabled">{{ngModelItem.elementLabel}}</span>
            </div>

            <div class="schema-folder-report"  ng-if="ngModelItem.elementRole == 'folder'" >
                <i ng-if="!ngModelItem.isCollapsed" class="fa fa-plus-square" ng-click="ngModelItem.isCollapsed = !ngModelItem.isCollapsed"></i>
                <i ng-if="ngModelItem.isCollapsed" class="fa fa-minus-square" ng-click="ngModelItem.isCollapsed = !ngModelItem.isCollapsed"></i>
                <a role="button" ng-click="ngModelItem.isCollapsed = !ngModelItem.isCollapsed">
                    {{ngModelItem.elementLabel}}
                </a>
            </div>
            <div collapse="!ngModelItem.isCollapsed && ngModelItem.elementRole != 'root'">
            <ul ng-if="ngModelItem.elementRole == 'folder' || ngModelItem.elementRole == 'root'" class="schema-container-report list-group" ng-class="">
                <li class="innerCont list-group-item hand-cursor schema-item-report" ng-repeat="innerItem in ngModelItem.elements">
                    <tg-dynamic-directive ng-model="innerItem" tg-dynamic-directive-view="getView">
                    </tg-dynamic-directive>
                </li>
            </ul>
            </div>
        </div>
    </script>




    <!--

    <div class="list-group data-source-tree" ng-repeat="dsource in dataSources">
        <a class="list-group-item active">
            {{dsource.collection.collectionLabel}}
        </a>
        <div ng-if="element.visible" ng-repeat="element in dsource.collection.elements">
            <a class="list-group-item data-source-element" draggable="true" effect-allowed="copy" draggable-type="custom-object"
               draggable-data="{
               elementName: element.elementName,
               objectLabel: element.elementLabel,
               datasourceID:dsource.datasourceID,
               collectionID:dsource.collection.collectionID,
               elementID: element.elementID,
               elementType: element.elementType,
               filterType: 'equal',
               filterPrompt: false,
               filterTypeLabel:'equal',
               values:element.values}">{{element.elementLabel}}</a>
            <a ng-if="element.elementType == 'number' || element.elementType == 'date'"
               class="list-group-item data-source-aggregation" ng-repeat="aggregation in fieldsAggregations[element.elementType]"
               draggable="true" effect-allowed="copy" draggable-type="custom-object" draggable-data="{
               elementName: element.elementName,
               objectLabel: element.elementLabel+' ('+aggregation.name+')',
               datasourceID:dsource.datasourceID,
               collectionID:dsource.collection.collectionID,
               elementID: element.elementID,
               elementType: element.elementType,
               filterType: 'equal',
               filterPrompt: false,
               filterTypeLabel:'equal',
               aggregation: aggregation.value}" ng-bind="aggregation.name"></a>
        </div>
        <div>
            <a class="list-group-item data-source-element" draggable="true" effect-allowed="copy" draggable-type="custom-object"
               draggable-data="{
               elementName: 'count',
               objectLabel: 'Count',
               datasourceID:dsource.datasourceID,
               collectionID:dsource.collection.collectionID,
               elementID: 'count',
               elementType: 'count',
               filterType: 'equal',
               filterPrompt: false,
               filterTypeLabel:'equal',
               count: true}">Count</a>

        </div>
    </div>

    -->


    <style>
        #metrics-list {
            list-style: none;
        }
        #metrics-list li {
            margin: 1px;
            padding: 5px;
            border: 1px solid black;
        }
    </style>
    <!--
    Metrics
    <ul id="metrics-list">
        <li x-lvl-draggable="true">Count</li>
        <li x-lvl-draggable="true">Count Unique Values</li>
        <li x-lvl-draggable="true">List Unique Values</li>
        <li x-lvl-draggable="true">Sum</li>
        <li x-lvl-draggable="true">Integer Sum</li>
        <li x-lvl-draggable="true">Average</li>
        <li x-lvl-draggable="true">Sum over Sum</li>
        <li x-lvl-draggable="true">80% Upper Bound</li>
        <li x-lvl-draggable="true">80% Lower Bound</li>
        <li x-lvl-draggable="true">Sum as Fraction of Total</li>
        <li x-lvl-draggable="true">Sum as Fraction of Rows</li>
        <li x-lvl-draggable="true">Sum as Fraction of Columns</li>
        <li x-lvl-draggable="true">Count as Fraction of Total</li>
        <li x-lvl-draggable="true">Count as Fraction of Rows</li>
        <li x-lvl-draggable="true">Count as Fraction of Columns</li>
    </ul>
    -->

</div>