<nd-modal id="reportNameModal">
    <!--<div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3></h3>
    </div>-->
    <div class="modal-body">
        <form class="simple-form" role="form" name="reportForm">
            <div class="form-group">
                <label>Report Name</label>
                <input name="reportName" type="text" class="form-control" ng-model="selectedReport.reportName" ng-required="true" required >
                <span ng-show="reportForm.reportName.$invalid" class="help-inline">This field is required</span>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn" data-dismiss="modal">Cancel</button>
        <button ng-click="reportNameSave()" ng-disabled="reportForm.$invalid || reportForm.$pristine" class="btn btn-primary submit-btn">Save</button>
    </div>
</nd-modal>

<div class="container-fluid" style="padding-bottom: 5px;padding-top: 5px;height: 40px;" ng-init="initForm()">
    <a ng-click="goBack()" class="btn btn-default pull-left">Cancel</a>
    <a data-ng-click="reportName()" class="btn btn-success pull-right" style="margin-right: 5px">Save Report</a>
</div>

<div class="row">

    <form class="simple-form" role="form" name="reportForm">
        <div class="col-md-6">
            <div class="form-group">
                <label>Report Type</label>
                <select class="form-control" name="reportType" ng-model="selectedReport.reportType"
                        ng-options="obj.value as obj.label for obj in reportTypes" ng-required="true" required ></select>
                <span ng-show="reportForm.reportType.$invalid" class="help-inline">This field is required</span>
            </div>
            <div class="form-group" ng-show="selectedReport.reportType == 'chart' || selectedReport.reportType == 'indicator' || selectedReport.reportType == 'vectorMap'">
                <label>Report SubType</label>
                <select class="form-control" name="reportSubType" ng-model="selectedReport.reportSubType"
                        ng-options="obj.value as obj.label for obj in reportSubTypes[selectedReport.reportType]" ng-required="true" required ></select>
                <span ng-show="reportForm.reportSubType.$invalid" class="help-inline">This field is required</span>
            </div>
        </div>

        <div class="col-md-6">

            <div ng-show="selectedReport.reportType == 'chart' && (selectedReport.reportSubType == 'line' || selectedReport.reportSubType == 'area')">
                <div class="form-group">
                    <label>xkey</label>
                    <select class="form-control" name="xkey" ng-model="selectedReport.properties.xkey"
                            ng-options="obj.elementID as obj.objectLabel for obj in columns" ng-required="true" required ></select>
                    <span ng-show="reportForm.xkey.$invalid" class="help-inline">This field is required</span>
                </div>
                <div class="form-group">
                    <label>xlabel</label>
                    <input name="xlabels" type="text" class="form-control" ng-model="selectedReport.properties.xlabels" ng-required="true" required >
                    <span ng-show="reportForm.xlabels.$invalid" class="help-inline">This field is required</span>
                </div>
                <div class="form-group">
                    <label>ykey</label>
                    <select class="form-control" name="ykeys" ng-model="selectedReport.properties.ykeys"
                            ng-options="obj.elementID as obj.objectLabel for obj in columns" ng-required="true" required ></select>
                    <span ng-show="reportForm.ykeys.$invalid" class="help-inline">This field is required</span>
                </div>
                <div class="form-group">
                    <label>ylabel</label>
                    <input name="labels" type="text" class="form-control" ng-model="selectedReport.properties.labels" ng-required="true" required >
                    <span ng-show="reportForm.labels.$invalid" class="help-inline">This field is required</span>
                </div>
            </div>

            <div ng-show="selectedReport.reportType == 'chart' && (selectedReport.reportSubType == 'bar' || selectedReport.reportSubType == 'donut')">
                <div class="form-group">
                    <label>Value Field</label>
                    <select class="form-control" name="valueField" ng-model="selectedReport.properties.valueField"
                            ng-options="obj.elementName as obj.objectLabel for obj in columns" ng-required="true" required ></select>
                    <span ng-show="reportForm.valueField.$invalid" class="help-inline">This field is required</span>
                </div>
                <div class="form-group">
                    <label>Label Field</label>
                    <select class="form-control" name="labelField" ng-model="selectedReport.properties.labelField"
                            ng-options="obj.elementName as obj.objectLabel for obj in columns" ng-required="true" required ></select>
                    <span ng-show="reportForm.labelField.$invalid" class="help-inline">This field is required</span>
                </div>
            </div>

        </div>

    </form>
</div>

<div class="container-fluid" style="border-bottom: 2px solid #72A230;">
     <h3 class="pull-right" >Query design zone</h3>
</div>

<div class="container-fluid" style="padding:10px" >
    <!--
    <div ng-nestable ng-model="filters" style="background-color: #FF0000; min-height: 40px;padding: 5px;">
        <div style="background-color: #FFFFFF; min-height: 10px;">

            {{$item.objectLabel}}
            <div class="dropdown">
                <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    {{$item.filterTypeLabel}}
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu4" >
                    <li ng-repeat="option in getElementFilterOptions($item.elementType)"><a ng-click="setFilterType($item,option)">{{option.label}}</a>

                    </li>

                </ul>
            </div>
            <input type="text" ng-model="$item.filterText1"/>
            <input type="text" ng-model="$item.filterText2"/>
        </div>
    </div>  -->

    <script type="text/ng-template" id="filtersGroup.html">
        <div class="container-fluid filter-zone no-padding" drop="onDrop($data, $event, 'group', group)" drop-effect="copy" drop-accept="'json/custom-object'" drag-over="onDragOver($event)" drag-over-class="drag-over-accept">
            <div class="filter-zone-label pull-right" ng-hide="filters.length > 0">Drop here your filters</div>
            <ul class="ul-drop no-padding" ng-model="group.filters" ui-sortable="sortableOptions">

                <div ng-repeat="filter in group.filters">

                    <li class="filter-box" ng-if="!filter.group && !filter.condition" style="margin-left: 90px;"
                        drop="onDropOnFilter($data, $event, filter)" drop-effect="copy" drop-accept="'json/custom-object'">

                        <div class="container-fluid">

                            <div class="dropdown" style="vertical-align: middle">
                                <span style="color:#72A230;font-weight: bold">{{filter.objectLabel}}</span>
                                <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                    <span style="color:#0000FF;">{{filter.filterTypeLabel}}</span>
                                    <span class="caret" style="color:#0000FF;"></span>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenu4" >
                                    <li ng-repeat="option in getElementFilterOptions(filter.elementType)"><a ng-click="setFilterType(filter,option)">{{option.label}}</a>

                                    </li>

                                </ul>
                                <input type="text" ng-model="filter.filterText1" ng-show="!(filter.filterType == 'null' || filter.filterType == 'notNull')"/>
                                <a class="btn btn-inverse btn-small" ng-click="getDistinctValues(filter)">search</a>
                                <span ng-show="filter.filterType == 'between' || filter.filterType == 'notBetween'"> and <input type="text" ng-model="filter.filterText2" />  </span>
                                <span class="pull-right" style="padding: 7px 0;"><i class="fa fa-times hand-cursor" ng-click="removeFromArray(group.filters, filter);filtersUpdated();processStructure();"></i></span>
                            </div>

                        </div>

                    </li>

                    <li ng-if="filter.condition">

                        <div class="dropdown" style="position: absolute; margin: -17px 0px 0px 0px; width: 90px; text-align: center;">
                            <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                <span style="color:#0000FF;" ng-bind="filter.conditionLabel"></span>
                                <span class="caret" style="color:#0000FF;"></span>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenu4" >
                                <li ng-repeat="condition in conditionTypes"><a ng-click="updateCondition(filter, condition)" ng-bind="condition.conditionLabel"></a></li>
                            </ul>
                        </div>

                    </li>

                    <li ng-if="filter.group" style="margin-left: 85px;">

                        <div ng-init="group=filter" ng-include="'filtersGroup.html'"></div>

                    </li>

                </div>

            </ul>
            <div ng-show="filters.length > 0" style="text-align: center;font-size: 15px;font-weight: bold;padding-bottom: 10px;">Drop new filters here</div>
        </div>
    </script>

    <div ng-repeat="group in filters" ng-include="'filtersGroup.html'"></div>

    <div class="container-fluid column-zone no-padding" drop="onDrop($data, $event, 'order')" drop-effect="copy" drop-accept="['json/custom-object','json/column']" drag-over="onDragOver($event)" drag-over-class="drag-over-accept">
        <div class="filter-zone-label pull-right" ng-hide="order.length > 0">Drop here order by elements</div>
        <!--<div class="column-box" draggable="true" effect-allowed="move" draggable-type="column" draggable-data="{objectLabel: '{{dim.objectLabel}}',objectID: '123456'}">campo1</div>
        <div class="column-box" draggable="true" effect-allowed="move" draggable-type="column" draggable-data="{objectLabel: '{{dim.objectLabel}}',objectID: '123456'}">campo 2</div>
        drop="onDrop($data, $event, 'column')" drop-effect="copy" drop-accept="['json/custom-object','json/column']" drag-over="onDragOver($event)" drag-over-class="drag-over-accept"
        -->
        <ul class="ul-drop no-padding" ng-model="order" ui-sortable="sortableOptions">
            <li class="column-box" ng-repeat="field in order" >{{field.objectLabel}}
                <i ng-show="field.sortType == -1" class="fa fa-chevron-down hand-cursor" ng-click="field.sortType = 1;processStructure();"></i>
                <i ng-show="field.sortType == 1" class="fa fa-chevron-up hand-cursor" ng-click="field.sortType = -1;processStructure();"></i>
                <i class="fa fa-times hand-cursor" ng-click="removeFromArray(order, field);processStructure();"></i>
            </li>
        </ul>
    </div>

    <div class="container-fluid column-zone no-padding" drop="onDrop($data, $event, 'column')" drop-effect="copy" drop-accept="['json/custom-object','json/column']" drag-over="onDragOver($event)" drag-over-class="drag-over-accept">
        <div class="filter-zone-label pull-right" ng-hide="columns.length > 0">Drop here your columns</div>
        <!--<div class="column-box" draggable="true" effect-allowed="move" draggable-type="column" draggable-data="{objectLabel: '{{dim.objectLabel}}',objectID: '123456'}">campo1</div>
        <div class="column-box" draggable="true" effect-allowed="move" draggable-type="column" draggable-data="{objectLabel: '{{dim.objectLabel}}',objectID: '123456'}">campo 2</div>
        drop="onDrop($data, $event, 'column')" drop-effect="copy" drop-accept="['json/custom-object','json/column']" drag-over="onDragOver($event)" drag-over-class="drag-over-accept"
        -->
        <ul class="ul-drop no-padding" ng-model="columns" ui-sortable="sortableOptions">
            <li class="column-box" ng-repeat="column in columns">
                <div class="dropdown">
                    {{column.objectLabel}}
                    <button class="btn btn-link dropdown-toggle" type="button" style="padding: 0px;"
                            id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        <span style="color:#0000FF;">{{column.variableLabel}}</span>
                        <i ng-show="column.elementType == 'string'" class="caret" style="color:#0000FF;"></i>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu4" >
                        <li ng-repeat="variable in stringVariables">
                            <a ng-click="column.variable = variable.value;column.variableLabel = variable.label;processStructure();">{{variable.label}}</a>
                        </li>
                    </ul>
                    <i class="fa fa-times hand-cursor" ng-click="removeFromArray(columns, column);processStructure();"></i>
                </div>

            </li>
        </ul>
        <span ng-show="columns.length > 0" class="pull-right" style="padding: 3px 10px;"><i class="fa fa-refresh hand-cursor" ng-click="processStructure();"></i></span>
    </div>
</div>

<div class="container-fluid" >

    <div class="table-responsive">
        <table class="table table-bordered">
            <thead>
                 <td ng-repeat="column in columns" ><strong>{{column.objectLabel}}</strong></td>
            </thead>
            <tbody>
            <tr ng-repeat="row in previewData" >
                <td ng-repeat="column in columns" >
                    <span ng-if="!column.aggregation">{{row[column.elementName]}}</span>
                    <span ng-if="column.aggregation">{{row[column.elementName+column.aggregation]}}</span>
                </td>
            </tr>
            <!--<tr style="font-weight: bold;">
                <td ng-repeat="aggregation in aggregations track by $index">{{aggregation}}</td>
            </tr>-->
            </tbody>
        </table>
    </div>

</div>

<div ng-include src="searchModal"></div>
